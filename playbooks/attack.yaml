---
- name: Update Attack VM
  hosts: localhost
  remote_user: root

  tasks:
    - name: Copy Update Script
      ansible.builtin.copy:
        src: "{{ playbook_dir }}/../update-attack-vm.sh"
        dest: /home/e1-attack/update-attack-vm.sh
        owner: root
        group: root
        mode: "0755"

    - name: This Course Sponsored by Berkeley
      ansible.builtin.import_tasks: tasks/use-berkeley-mirrors.yaml
      when: ansible_architecture == "aarch64"

    - name: Install Random APT Packages
      ansible.builtin.apt:
        pkg:
          - python-is-python3
          - git
          - nano
          - openssh-server
          - open-vm-tools
          - open-vm-tools-desktop

    - name: Pull Scavenger Hunt
      become: true
      become_user: e1-attack
      ansible.builtin.git:
        repo: https://github.com/ucla-e1-malware/linux-scavenger-hunt.git
        dest: /home/e1-attack/linux-scavenger-hunt
        version: main
        force: true
